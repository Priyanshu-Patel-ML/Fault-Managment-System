{
  "version": "1.0.0",
  "title": "Database Cleanup Experiment",
  "description": "Intelligent database cleanup - checks record count and cleans up only when needed",
  "tags": ["database", "cleanup", "maintenance", "mongodb", "auto-cleanup"],
  "method": [
    {
      "name": "Check current database size",
      "type": "probe",
      "provider": {
        "type": "python",
        "module": "db_cleanup",
        "func": "count_posts_direct",
        "arguments": {
          "db_host": "20.3.50.187",
          "db_port": 27017,
          "database_name": "post",
          "collection_name": "post"
        }
      }
    },
    {
      "name": "Auto cleanup if records exceed threshold",
      "type": "action",
      "provider": {
        "type": "python",
        "module": "db_cleanup",
        "func": "auto_cleanup_if_needed",
        "arguments": {
          "db_host": "20.3.50.187",
          "db_port": 27017,
          "database_name": "post",
          "collection_name": "post",
          "threshold": 10000,
          "keep_count": 10000
        }
      }
    },
    {
      "name": "Verify final database size",
      "type": "probe",
      "provider": {
        "type": "python",
        "module": "db_cleanup",
        "func": "count_posts_direct",
        "arguments": {
          "db_host": "20.3.50.187",
          "db_port": 27017,
          "database_name": "post",
          "collection_name": "post"
        }
      }
    }
  ],
  "rollbacks": [
    {
      "name": "Final verification after cleanup",
      "type": "probe",
      "provider": {
        "type": "python",
        "module": "db_cleanup",
        "func": "count_posts_direct",
        "arguments": {
          "db_host": "20.3.50.187"
        }
      }
    }
  ]
}
